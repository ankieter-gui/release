<!DOCTYPE html>
<html class="writer-html5" lang="pl" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wstęp &mdash; Ankieter+  - dokumentacja</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Indeks" href="../genindex.html" />
    <link rel="search" title="Szukaj" href="../search.html" />
    <link rel="next" title="convert module" href="../convert.html" />
    <link rel="prev" title="Pobranie nowej wersji" href="dla_administratora.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Ankieter+
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Szukaj" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Spis treści:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Wstęp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#dla-uzytkownika">Dla użytkownika</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#dla-administratora">Dla administratora</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html#dla-programisty">Dla programisty</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Wstęp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jezyk-zapytan-dla-zestawien">Język zapytań dla zestawień</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jak-dodac-nowy-rodzaj-wykresu">Jak dodać nowy rodzaj wykresu?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert.html">convert module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database.html">database module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error.html">error module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../grammar.html">grammar module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../setup.html">setup module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../table.html">table module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../main.html">main module</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ankieter+</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../modules.html">Wstęp</a> &raquo;</li>
      <li>Wstęp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/md/dla_programisty.md.txt" rel="nofollow"> Zobacz źródło strony</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="wstep">
<h1>Wstęp<a class="headerlink" href="#wstep" title="Stały odnośnik do tego nagłówka"></a></h1>
<p>W poniższym rozdziale przedstawiono dokumentację modułów wykorzystywanych w aplikacji oraz omówiono działanie niektórych jej charakterystycznych mechanik.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="jezyk-zapytan-dla-zestawien">
<h1>Język zapytań dla zestawień<a class="headerlink" href="#jezyk-zapytan-dla-zestawien" title="Stały odnośnik do tego nagłówka"></a></h1>
<p>Wyświetlenie wykresu w edytorze raportów wymaga wysłania przez frontendową części aplikacji zapytania do serwera. W takim zapytaniu zawarte są informacje o interesujących użytkownika agregacjach, które mają następnie znaleźć się w wykresie.</p>
<p>Ponieważ zapytania te są opisane w stworzonym specjalnie dla Ankietera+ języku, został on w tej sekcji dokładnie opisany.</p>
<p>W ogólności język stosowany w Ankieterze+ opisuje dobrze znane <em>zapytania krzyżowe</em>.
Wszystkie zapytania mają JSONowy format przestrzegający następującego szablonu:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;get&quot;</span><span class="p">:</span>    <span class="p">[[</span><span class="n">column</span><span class="o">-</span><span class="n">names</span><span class="o">...</span><span class="p">]],</span>
  <span class="s2">&quot;as&quot;</span><span class="p">:</span>     <span class="p">[</span><span class="n">aggregation</span><span class="o">-</span><span class="n">names</span><span class="o">...</span><span class="p">],</span>
  <span class="s2">&quot;by&quot;</span><span class="p">:</span>     <span class="p">[</span><span class="n">column</span><span class="o">-</span><span class="n">names</span><span class="o">...</span><span class="p">],</span>
  <span class="s2">&quot;if&quot;</span><span class="p">:</span>     <span class="p">[[</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">/</span><span class="n">column</span><span class="o">-</span><span class="n">number</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">]],</span>
  <span class="s2">&quot;except&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">]],</span>
  <span class="s2">&quot;join&quot;</span><span class="p">:</span>   <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">column</span><span class="o">-</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;of&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">source</span><span class="o">-</span><span class="n">column</span><span class="o">-</span><span class="n">names</span><span class="o">...</span><span class="p">]}],</span>
  <span class="s2">&quot;macro&quot;</span><span class="p">:</span>  <span class="p">[</span><span class="n">macro</span><span class="o">-</span><span class="n">names</span><span class="o">...</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Każde zapytanie dzieli się więc na siedem klauzul, z których jedynie dwie pierwsze są wymagane. Część informacji o strukturze zapytań można znaleźć w pliku <code class="docutils literal notranslate"><span class="pre">grammar.py</span></code>.</p>
<p>Klauzula <code class="docutils literal notranslate"><span class="pre">get</span></code> jest <em>tablicą tablic nazw kolumn</em>.
Są to nazwy kolumn, na podstawie których obliczane będą wartości funkcji agregujących.
Fakt, że nazwy kolumn zawarte są w podwójnie zagnieżdżonej tablicy może być mylący;
ale dla zrozumienia języka zapytań wystarczy początkowo założyć, że jest to zwykła tablica, a powód podwójnego jej zagnieżdżenia zostanie wyjaśniony później.
Ważne jest, że kolejne nazwy zmiennych klauzuli <code class="docutils literal notranslate"><span class="pre">get</span></code> odpowiadają kolejnym kolumnom wynikowym zestawieniu.</p>
<p>Klauzula <code class="docutils literal notranslate"><span class="pre">as</span></code> jest listą nazw funkcji agregujących, które będą aplikowane do zmiennych położonych na <em>odpowiadających</em> pozycjach w klauzuli <code class="docutils literal notranslate"><span class="pre">get</span></code>.</p>
<p>Klauzula <code class="docutils literal notranslate"><span class="pre">by</span></code> opisuje zmienne, po których grupowane będą wartości kolumn z klauzuli <code class="docutils literal notranslate"><span class="pre">get</span></code>. Wartości należące do tej samej grupy będą podlegały wspólnej agregacji i w efekcie zostaną przekształcone na pojedynczą wartość (np. liczność grupy, średnią albo największą wartość dla grupy itd.). Jeśli wszyscy użytkownicy mają trafić do jednej grupy, aby podsumować jakąś informację na temat całego zbioru, jako nazwa zmiennej grupującej podawana jest <em>gwiazdka</em> (<code class="docutils literal notranslate"><span class="pre">&quot;by&quot;:</span> <span class="pre">[&quot;*&quot;]</span></code>). Nazwy grup stanowią <em>nazwy wierszy</em> w wynikowych danych. Warto przy tym zauważyć, że wartość w klauzuli <code class="docutils literal notranslate"><span class="pre">by</span></code> jest tablicą, co jest wykorzystywane w sytuacjach, w których w jednym zestawieniu tworzone jest kilka rodzajów grup (np. podział na roczniki + podział na stopień studiów + wszyscy razem). W takiej sytuacji jeden rekord może trafić do kilku grup jednocześnie, ale nie zmienia to formatu wyniku – zawiera on podsumowania (agregacje) na temat każdej z grup.</p>
<p>Zawartość klauzuli <code class="docutils literal notranslate"><span class="pre">if</span></code> jest tablicą filtrów. Każdy filtr jest tablicą o następującym formacie:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">/</span><span class="n">column</span><span class="o">-</span><span class="n">number</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Jeśli pierwszym elementem filtra jest nazwa zmiennej, to filtrowany rekord musi mieć zmienną spełniającą opisany w filtrze wymóg, aby znaleźć się w analizowanym zbiorze. Na przykład:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;Kierunek studiów&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;Kognitywistyka&quot;</span><span class="p">,</span> <span class="s2">&quot;Informatyka&quot;</span><span class="p">,</span> <span class="s2">&quot;Fizyka&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>lub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;Rok studiów&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Lista filtrów i opis ich działania zostały zawarte w pliku źródłowym <code class="docutils literal notranslate"><span class="pre">table.py</span></code>.</p>
<p>Jeśli jednak pierwszym elementem filtra jest liczba, to musi ona odpowiadać jednej z kolumn zdefiniowanych przez klauzulę <code class="docutils literal notranslate"><span class="pre">get</span></code>. Filter taki nie usuwa całych rekordów, ale usuwa wartości zmiennych, które nie będą podlegały agregacji, np. wartości specjalne nie posiadające interpretacji liczbowej:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;!=&quot;</span><span class="p">,</span> <span class="s2">&quot;Nie dotyczy&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Klauzula <code class="docutils literal notranslate"><span class="pre">except</span></code> działa odwrotnie do <code class="docutils literal notranslate"><span class="pre">if</span></code>. Jeśli rekord spełni <em>wszystkie</em> wymienione w niej wymagania, to rekord <em>jest usuwany</em> z analizowanego zbioru. Pozwala to wybrać podzbiór, którego analiza nie dotyczy.</p>
<p>W klauzuli <code class="docutils literal notranslate"><span class="pre">join</span></code> można tworzyć nowe kolumny na podstawie już istniejących.
Umożliwia to wyliczenie średniej z kilku zmiennych, na przykład:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;get&quot;</span><span class="p">:</span>  <span class="p">[[</span><span class="s2">&quot;Ocena ogólna&quot;</span><span class="p">]],</span>
  <span class="s2">&quot;as&quot;</span><span class="p">:</span>   <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
  <span class="s2">&quot;by&quot;</span><span class="p">:</span>   <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
  <span class="s2">&quot;join&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ocena ogólna&quot;</span><span class="p">,</span>
      <span class="s2">&quot;of&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Ocena dziekanatu&quot;</span><span class="p">,</span> <span class="s2">&quot;Ocena zajęć&quot;</span><span class="p">,</span> <span class="s2">&quot;Ocena prowadzących&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;except&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Rok studiów&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Zestawienie to podlicza średnią wartość zmiennej, na którą składają się oceny poszczególnych aspektów pracy wydziału lub uniwersytetu. Zestawienie da pojedyncza wartość dla całego zbioru, wykluczy przy tym studentów 1. roku, którzy nie ukończyli jeszcze żadnych zajęć.</p>
<p>Ostatni klauzula, <code class="docutils literal notranslate"><span class="pre">macro</span></code> zawiera nazwę makra, która jest wykrywana przez funkcje obsługujące zapytania i na jej podstawie zapytanie jest uzupełniane. Jest to najnowszy element języka zapytań używanego przez Ankieter+ i został dodany w ramach optymalizacji aplikacji. Z tego powodu istnieje na razie tylko jedno makro, <code class="docutils literal notranslate"><span class="pre">count-answers</span></code>, które na podstawie kolumn w <code class="docutils literal notranslate"><span class="pre">get</span></code> uzupełnia zapytanie tak, aby zwróciło ono liczbę osób, które odpowiedziały na <em>przynajmniej jedno</em> z tych pytań.</p>
<p>Ponadto, klauzula <code class="docutils literal notranslate"><span class="pre">get</span></code> jest <em>tablicą tablic</em>, dzięki temu do zapytania można dołączać wiele list kolumn, o ile każda z nich ma tę samą długość. Takie zapytanie zostanie wykonane jako kilka zapytań podlegających tym samym filtrom i agregacjom. Używane jest to w sytuacjach, kiedy temu samemu zestawieniu podlega kilka podobnych do siebie zmiennych:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;get&quot;</span><span class="p">:</span>    <span class="p">[[</span><span class="s2">&quot;Ocena dziekanatu&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Ocena zajęć&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Ocena prowadzących&quot;</span><span class="p">]],</span>
  <span class="s2">&quot;as&quot;</span><span class="p">:</span>     <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
  <span class="s2">&quot;by&quot;</span><span class="p">:</span>     <span class="p">[</span><span class="s2">&quot;Rok studiów&quot;</span><span class="p">],</span>
  <span class="s2">&quot;if&quot;</span><span class="p">:</span>     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;!=&quot;</span><span class="p">,</span> <span class="s2">&quot;Odmowa odpowiedzi&quot;</span><span class="p">],</span>
  <span class="s2">&quot;except&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rok studiów&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Wyniki zapytania mają następujący format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;index&quot;</span><span class="p">:</span>              <span class="p">[</span><span class="n">group1</span><span class="o">-</span><span class="n">name</span><span class="p">,</span> <span class="n">group2</span><span class="o">-</span><span class="n">name</span><span class="o">...</span><span class="p">],</span>
  <span class="s2">&quot;aggregated-value-A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="k">for</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="k">for</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
  <span class="s2">&quot;aggregated-value-B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="k">for</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="k">for</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nazwy wierszy (<code class="docutils literal notranslate"><span class="pre">index</span></code>) pochodzą od nazw zmiennych użytych w klauzuli <code class="docutils literal notranslate"><span class="pre">by</span></code>. Z kolei nazwy kolumn (pozostałe klucze) mają format <code class="docutils literal notranslate"><span class="pre">aggegator-name</span> <span class="pre">variable-name</span></code>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="jak-dodac-nowy-rodzaj-wykresu">
<h1>Jak dodać nowy rodzaj wykresu?<a class="headerlink" href="#jak-dodac-nowy-rodzaj-wykresu" title="Stały odnośnik do tego nagłówka"></a></h1>
<p>Wykresy są generowane za pomocą biblioteki [https://echarts.apache.org/](apache echarts). Aby dodać nowy wykres, najłatwiej odwiedzić stronę z <span class="xref myst">https://echarts.apache.org/examples/en/index.html</span> i poszukać wykresu zbliżonego. Po wejściu na jego podstronę można eksperymentować, dostosowując interaktywnie różne opcje. Gdy stworzymy już konfigurację taką jaką chcemy, możemy przejść do integracji nowego wykresu do aplikacji. Zapisz gdzieś obiekt JSON options do użycia później.</p>
<p>Tworzenie wykresu jest kilkuetapowe - najpierw dane do serwowane do klasy generującej <code class="docutils literal notranslate"><span class="pre">options</span></code> - obiekt JSONa, następnie jest on ponowanie modyfikowany przez <code class="docutils literal notranslate"><span class="pre">ColorsGenerator</span></code>. Pełny proces generowania nowego wykresu jest zawarty w <code class="docutils literal notranslate"> <span class="pre">generateChart(series:</span> <span class="pre">any,</span> <span class="pre">chartElement:</span> <span class="pre">ChartReportElement,</span> <span class="pre">reportId,</span> <span class="pre">namingDictioanry,</span> <span class="pre">dictionaryOverrides,</span> <span class="pre">localOverrides</span> <span class="pre">=</span> <span class="pre">undefined,fullQuery=undefined):</span> <span class="pre">EChartsOption</span></code> w pliku <code class="docutils literal notranslate"><span class="pre">charts.service.ts</span></code>.</p>
<p>Klasa generująca <code class="docutils literal notranslate"><span class="pre">options</span></code> musi dziedziczyć po <code class="docutils literal notranslate"><span class="pre">AbstractChartGenerator</span></code>. Każda taka klasa pochodna musi zostać także zarejestrowana w funkcji: <code class="docutils literal notranslate"><span class="pre">getGenerator</span></code> w <code class="docutils literal notranslate"><span class="pre">charts.service.ts</span></code> przez dopisanie do słownika <code class="docutils literal notranslate"><span class="pre">strategyType</span></code> nowododanej klasy jako wartość. Kluczem niech będzie krótka nazwa <code class="docutils literal notranslate"><span class="pre">string</span></code> używana do identyfikacji klasy. Taki słownik jest workaroundem bo przez niektóre ograniczenia Angulara nie można podać klasy jako first class object w template komponentu.</p>
<p>Aby dodać nowy wykres:</p>
<ol class="arabic simple">
<li><p>Tworzymy nowy plik o nazwie MyChart.ts.</p></li>
<li><p>Wklejamy tam szablon klasy generującej <code class="docutils literal notranslate"><span class="pre">options</span></code> wykresu</p></li>
</ol>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">class</span> <span class="nx">MyChartGenerator</span> <span class="k">extends</span> <span class="nx">AbstractChartGenerator</span> <span class="p">{</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="nx">series</span>: <span class="kt">any</span><span class="p">,</span> <span class="nx">chartElement</span>: <span class="kt">ChartReportElement</span><span class="p">,</span> <span class="nx">namingDictionary</span><span class="p">,</span> <span class="k">public</span> <span class="nx">reportsService</span>: <span class="kt">ReportsService</span><span class="p">,</span> <span class="nx">dictionaryOverrides</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">series</span><span class="p">,</span> <span class="nx">chartElement</span><span class="p">,</span> <span class="nx">namingDictionary</span><span class="p">,</span> <span class="nx">reportsService</span><span class="p">,</span> <span class="nx">dictionaryOverrides</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">generate</span><span class="p">()</span><span class="o">:</span> <span class="nx">AbstractChartGenerator</span> <span class="p">{</span>

      <span class="k">return</span> <span class="k">this</span>
  <span class="p">}</span>

  <span class="nx">getAllCount</span><span class="p">(</span><span class="nx">reportId</span><span class="p">,</span> <span class="nx">complimentedQuery</span>: <span class="kt">SurveyQuery</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="nx">asJSONConfig</span><span class="p">()</span><span class="o">:</span> <span class="nx">EChartsOption</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{}</span> <span class="kr">as</span> <span class="nx">EChartsOption</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">generate()</span></code> jest wywoływane jednorazowo przy każdej zmianie ustawień wykresu w UI przez użytkownika. <code class="docutils literal notranslate"><span class="pre">asJSONConfig()</span></code> zwraca <code class="docutils literal notranslate"><span class="pre">options</span></code> wykresu. Należy wkleić to co wygenerowaliśmy w kreatorze na stronie echarts z dodatkowym uzupełnieniem o serie danych.
Serie danych pochodzą bezośrednio z response z serwera i są dostępne pod <code class="docutils literal notranslate"><span class="pre">this.rawSeries</span></code></p>
<ol class="arabic simple">
<li><p>Wybieramy tekstowy identyfikator klasy - może to być jej nazwa zapisana w klasie jako <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">name</span> <span class="pre">=</span> <span class="pre">&quot;MyChart&quot;</span></code></p></li>
<li><p>Otwieramy plik <code class="docutils literal notranslate"><span class="pre">reports/editor/chart-editor-view.component.ts</span></code></p></li>
<li><p>Szykujemy obrazek-miniaturkę wykresu i umieszczamy ją w <code class="docutils literal notranslate"><span class="pre">assets/</span></code></p></li>
<li><p>W <code class="docutils literal notranslate"><span class="pre">reports/editor/chart-editor-view.component.ts</span></code> ctrl+f <code class="docutils literal notranslate"> <span class="pre">&lt;nz-tab</span> <span class="pre">nzTitle=&quot;Wygląd</span> <span class="pre">i</span> <span class="pre">układ&quot;&gt;</span></code>  <br>
W elemencie <code class="docutils literal notranslate"><span class="pre">&lt;section</span> <span class="pre">class=&quot;query-marker&quot;&gt;&lt;/section&gt;</span></code> dodajemy markup <br></p></li>
</ol>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>&lt;div class=&quot;spacer&quot;&gt;&lt;/div&gt;
&lt;figure class=&quot;indicator-card indicator-card-velvet preset&quot;
       nz-tooltip=&quot;Użyj tego wykresu aby przedstawić wyniki z pytań wielokrotnego wyboru. Na przykład: dlaczego poleciłbyś UAM&quot;
       (click)=&quot;pickPreset(&#39;multipleChoice&#39;);&quot;&gt;
 &lt;div class=&quot;indicator-card-inner&quot;&gt;
   &lt;div class=&quot;indicator-card-header&quot;&gt;Wielokrotny wybór&lt;/div&gt;
   &lt;div class=&quot;indicator-card-content&quot;&gt;&lt;img src=&quot;./assets/preset2.png&quot; style=&quot;width: 100%&quot;&gt;&lt;/div&gt;
 &lt;/div&gt;
&lt;/figure&gt;             
</pre></div>
</div>
<p>Do uzupełniania: tooltip, miniaturka, nazwa i <code class="docutils literal notranslate"><span class="pre">(click)=&quot;pickPreset('MyChart');&quot;</span></code>,  gdzie MyChart to nazwa naszego nowego wykresu identyczną z ustaloną wcześniej.</p>
<ol class="arabic simple">
<li><p>Do funkcji pickPreset w tym samym pliku dopisujemy klucz do słownika <code class="docutils literal notranslate"><span class="pre">fun</span></code>.
<br> Wartością jest funkcja bez argumentów która ustawia różne parametry charakterystyczne dla tego rodzaju wykresu i sposób w jaki układane jest zapytanie do bazy danych. <br>
Możemy schować prawą kolumnę <code class="docutils literal notranslate"><span class="pre">Grupuj</span> <span class="pre">przez</span></code> ustawiając <code class="docutils literal notranslate"><span class="pre">this.hideGrupBy=true;</span></code>, schować panel wybierania rodzajów agregeacji <code class="docutils literal notranslate"> <span class="pre">this.hideData=true;</span></code>. <br>
Zmienić zachowania po kliknięciu jakiegoś elementu interfejsu: ..
<code class="docutils literal notranslate"><span class="pre">this.onPickQuestion=(question)=&gt;{}</span></code>
<code class="docutils literal notranslate"><span class="pre">this.byPickerClick</span> <span class="pre">=</span> <span class="pre">(by)</span> <span class="pre">=&gt;</span> <span class="pre">{}</span></code> <br>
Ustawić domyślny typ agregacji: <code class="docutils literal notranslate">&#160; <span class="pre">this.chartData.dataQuery.as[0]='share'</span></code> <br>
Ustawić domyślny typ grupowania <code class="docutils literal notranslate"> <span class="pre">this.chartData.dataQuery.by[0]</span> <span class="pre">=</span> <span class="pre">&quot;*&quot;</span></code> <br>
Lub zrobić cokolwiek innego co jest potrzebne aby umożliwić użytkownikowi wybranie wszystkich potrzebnych opcji.</p></li>
<li><p>Teraz należy wyświetlić gotowy wykres. Do fragmentu <code class="docutils literal notranslate">&#160; <span class="pre">&lt;section</span> <span class="pre">class=&quot;chart-area&quot;</span> <span class="pre">*ngIf=&quot;['multipleChoice',</span> <span class="pre">'groupedBars',</span> <span class="pre">'multipleBars',</span> <span class="pre">'linearCustomData',</span> <span class="pre">'summary','groupSummary',</span> <span class="pre">'multipleBarsOwnData'].includes(chartData.config.type)</span>&#160; <span class="pre">&amp;&amp;</span> <span class="pre">this.echartOptions&quot;&gt;</span></code> należy dopisać nasz typ wykresu żeby się wyświetlał w domyślnym trybie - jako prosty wykres generowany na podstawie <code class="docutils literal notranslate"><span class="pre">options</span></code></p></li>
<li><p>(Opcjonalnie) Ostatnią czynnością jest kolorowanie wykresu. W <code class="docutils literal notranslate"><span class="pre">ColorsGenerator.ts</span></code> dodajemy do słownika x nowy wpis <code class="docutils literal notranslate"><span class="pre">[MyChartGenerator.name]</span> <span class="pre">=</span> <span class="pre">(o)</span> <span class="pre">=&gt;</span> <span class="pre">this.myChartGenerator(o);</span></code>
oraz nową funkcję do klasy <br></p></li>
</ol>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">myChartGenerator</span><span class="p">(</span><span class="nx">options</span>: <span class="kt">EChartsOption</span><span class="p">)</span><span class="o">:</span> <span class="nx">EChartsOption</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">options</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>która modyfikuje i zwraca obiekt options w celu nadania kolorów i kosmetyki konkretnym seriom lub elementom. <br>
Jeżeli nie jest to potrzebne można nic nie dodawać.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dla_administratora.html" class="btn btn-neutral float-left" title="Pobranie nowej wersji" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Poprzedni</a>
        <a href="../convert.html" class="btn btn-neutral float-right" title="convert module" accesskey="n" rel="next">Następny <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, UAM.</p>
  </div>

  Zbudowano w <a href="https://www.sphinx-doc.org/">Sphinx</a> używając
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    dostarczone przez <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>